<!DOCTYPE html>
<html>
	<head>
	<script src="http://ajax.googleapis.com/ajax/libs/jquery/1.10.2/jquery.min.js">
	</script>
	</head> 
	<body>
		<script type="text/javascript">
			window.onload = function () { 
				var headers = new Array("Artist", "Album", "Title")
				var table = document.getElementById("musictable");
				var header = table.createTHead();
				var row = table.insertRow(0);
				var index = 0;
				
				for (headerTitle in headers) 
				{
					var cell = row.insertCell(index);
					cell.innerHTML = headers[index].bold();
					index++;
				}

				document.body.appendChild(newSearchForm(loadSongs))
			}
			
			function loadSongs(song) {
				var table = document.getElementById("musictable");
				var json = formSongGet(song);
				
				try 
				{				
					var songList = JSON.parse(httpGet(json));
					
					for (var song in songList)
					{
						song = songList[song]
						var rowIndex = table.rows.length;
						var songRow = table.insertRow(rowIndex);
						
						var valueCell = songRow.insertCell(0);
						valueCell.innerHTML = song.Artist;
						
						valueCell = songRow.insertCell(1);
						valueCell.innerHTML = song.Album;
						
						valueCell = songRow.insertCell(2);
						valueCell.innerHTML = song.Title;
						
						rowIndex++;
					}
				}
				catch(err)
				{}
			}
			
			function formSongGet(song)
			{
				var query = "/query/test?";

				for (key in song)
				{
					if (song[key] != "")
					{
						query += key + "=" + song[key];
						query += "&";
					}
				}
				
				return query
			}
			
			function httpGet(theUrl)
			{
			    var xmlHttp = null;

			    xmlHttp = new XMLHttpRequest();0
			    xmlHttp.open( "GET", theUrl, false );
			    xmlHttp.send( null );
			    return String(xmlHttp.responseText);
			}
			
			function newSearchForm(submitCallback)
			{
				searchMenu = document.createElement("span");
				searchTable = document.createElement("table");
				insertInput = function(name) {
					input = document.createElement("input");
					searchTable.innerHTML += 
					"<tr> \
					  <td>" + name + "</td> \
					  <td>" + input.outerHTML + "</td>  \
					</tr>";
					return input;
				}

				titleSearch2 = insertInput("title")
				artistSearch2 = insertInput("artist")
				albumSearch2 = insertInput("album")


				titleSearch = document.createElement("input");
				artistSearch = document.createElement("input");
				albumSearch = document.createElement("input")
				
				submitButton = document.createElement("button");
				submitButton.onclick = function () 
					{ 
						submitCallback(
							{
								Title : titleSearch.value,
								Artist : artistSearch.value,
								Album : albumSearch.value,
							}
						);
					};
					
				submitButton.innerHTML = "Search"
				submitButton.id = "1"
				searchMenu.appendChild(submitButton)
				searchMenu.appendChild(titleSearch)
				searchMenu.appendChild(artistSearch)
				searchMenu.appendChild(albumSearch)
				
				return searchTable;
			}

			function addSearchParamRow(table, name)
			{
				// defaultText = typeof defaultType !== 'undefined' ? defaultText : 42;
				table.insertRow(table.rows.length) = document.createElement("p");
				para.innerHTML = name;
				para.appendChild(document.createElement("input"));
				return para;
			}

		</script>
		<table id="musictable" border="1">
		</table>
		</form> 	
	</body>
</html>